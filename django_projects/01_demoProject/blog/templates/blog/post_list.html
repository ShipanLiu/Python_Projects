<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>post list</title>
</head>
<body>
    <h1>Post List</h1>
    <ul>
        {% for post in posts %}
            <li>
                <h2>{{ post.title }}</h2>
                <p>{{ post.content }}</p>
                <p>Posted by: {{ post.user.username }}</p>
                <p>Created at: {{ post.created_time }}</p>
                <form method="post" action="/demo/create_comment/{{ post.id }}">
                    <textarea name="content" placeholder="Add a comment"></textarea>
                    <button type="submit">Submit Comment</button>
                </form>
                <ul>
                    <!-- post.comments , this is defined in Comment in "related_name='comments'"   -->
                    {% for comment in post.comments.all %}
                        <li>
                            <p>{{ comment.content }}</p>
                            <p>Commented by: {{ comment.user.username }}</p>
                            <p>Created at: {{ comment.created_time }}</p>
                            <form method="post" action="/demo/create_comment_reply/{{ comment.id }}">
                                <textarea name="content" placeholder="Reply to this comment"></textarea>
                                <button type="submit">Submit Reply</button>
                            </form>
                            <ul>
                                {% for reply in comment.replies.all %}
                                    <li>
                                        <p>{{ reply.content }}</p>
                                        <p>Replied by: {{ reply.user.username }}</p>
                                        <p>Created at: {{ reply.created_time }}</p>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>
</body>
</html>
